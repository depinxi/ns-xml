<?xml version="1.0" encoding="UTF-8"?>
<!-- Copyright Â© 2011-2012 by Renaud Guillard (dev@nore.fr) -->
<!-- Distributed under the terms of the MIT License, see LICENSE -->
<sh:functions xmlns:sh="http://xsd.nore.fr/bash">
	<!-- in place file text replacement using sed -->
	<!-- Take care of sed version (at least on Mac OS X 10.5) -->
	<sh:function name="ns_sed_inplace">
		<sh:parameter name="regex" />
		<sh:body><![CDATA[
# sedForm
# 1: modern linux => sed --in-place
# 2: Mac OS X 10.5-10.8 - => sed -i ""
# TODO test Mac OS X < 10.5
local sedForm=1
if [ "$(uname -s)" == "Darwin" ]
then
	local macOSXVersion="$(sw_vers -productVersion)"
	if [ ! -z "${macOSXVersion}" ]
	then
		local macOSXMajorVersion="$(echo "${macOSXVersion}" | cut -f 1 -d".")"
		local macOSXMinorVersion="$(echo "${macOSXVersion}" | cut -f 2 -d".")"
		if [ ${macOSXMajorVersion} -eq 10 ] && [ ${macOSXMinorVersion} -ge 5 ]
		then
			sedForm=2
		fi
	fi	
fi

while [ $# -gt 0 ]
do	
	if [ ${sedForm} -eq 1 ]
	then
		sed --in-place "${regex}" "${1}"
	elif [ ${sedForm} -eq 2 ]
	then
		sed -i "" "${regex}" "${1}"
	fi
	
	shift
done
]]></sh:body>
	</sh:function>
</sh:functions>
