<?xml version="1.0" encoding="UTF-8"?>
<sh:functions xmlns:sh="http://xsd.nore.fr/bash">
	<sh:function name="ns_isdir">
		<sh:parameter name="path"/>
		<sh:body><![CDATA[
[ ! -z "${path}" ] && [ -d "${path}" ]
		]]></sh:body>
	</sh:function>
	<sh:function name="ns_issymlink">
		<sh:parameter name="path"/>
		<sh:body><![CDATA[
[ ! -z "${path}" ] && [ -L "${path}" ]
		]]></sh:body>
	</sh:function>
	<sh:function name="ns_realpath">
		<sh:parameter name="path"/>
		<sh:body><![CDATA[
local cwd="$(pwd)"
[ -d "${path}" ] && cd "${path}" && path="."
while [ -h "${path}" ] ; do path="$(readlink "${path}")"; done

if [ -d "${path}" ]
then
	path="$( cd -P "$( dirname "${path}" )" && pwd )"
else
	path="$( cd -P "$( dirname "${path}" )" && pwd )/$(basename "${path}")"
fi

cd "${cwd}" 1>/dev/null 2>&1
echo "${path}"
		]]></sh:body>
	</sh:function>
	<sh:function name="ns_relativepath">
		<sh:parameter name="from"/>
		<sh:parameter name="base">
.
        </sh:parameter>
		<sh:body><![CDATA[
[ -r "${from}" ] || return 1
[ -r "${base}" ] || return 2
[ ! -d "${base}" ] && base="$(dirname "${base}")"  
[ -d "${base}" ] || return 3
from="$(ns_realpath "${from}")"
base="$(ns_realpath "${base}")"
#echo from: $from
#echo base: $base
c=0
sub="${base}"
newsub=""
while [ "${from:0:${#sub}}" != "${sub}" ]
do
	newsub="$(dirname "${sub}")"
	[ "${newsub}" == "${sub}" ] && return 4
	sub="${newsub}"
	c="$(expr ${c} + 1)"
done
res="."
for ((i=0;${i}<${c};i++))
do
	res="${res}/.."
done
res="${res}${from#${sub}}"
res="${res#./}"
echo "${res}"
		]]></sh:body>
	</sh:function>
	<sh:function name="ns_mktemp">
		<sh:parameter name="key">
$(date +%s)
        </sh:parameter>
		<sh:body><![CDATA[
if [ "$(uname -s)" == "Darwin" ]
then
	#Use key as a prefix
	mktemp -t "${key}"
else
	#Use key as a suffix
	mktemp --suffix "${key}"
fi
]]></sh:body>
	</sh:function>
	<sh:function name="ns_mktempdir">
		<sh:parameter name="key">
$(date +%s)
        </sh:parameter>
		<sh:body><![CDATA[
if [ "$(uname -s)" == "Darwin" ]
then
	#Use key as a prefix
	mktemp -d -t "${key}"
else
	#Use key as a suffix
	mktemp -d --suffix "${key}"
fi
]]></sh:body>
	</sh:function>
</sh:functions>
